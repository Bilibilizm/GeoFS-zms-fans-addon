(function () {
    'use strict';

    // 创建主界面容器
    const overlay = document.createElement('div');
    overlay.style.position = 'fixed';
    overlay.style.top = '0';
    overlay.style.right = '0';
    overlay.style.width = '300px'; // 缩小界面宽度
    overlay.style.height = '100%';
    overlay.style.backgroundColor = '#f5f5f5';
    overlay.style.zIndex = '1001';
    overlay.style.boxShadow = '-2px 0 10px rgba(0, 0, 0, 0.1)';
    overlay.style.display = 'none';
    overlay.style.flexDirection = 'column';
    overlay.style.fontFamily = 'Arial, sans-serif';
    overlay.style.overflow = 'hidden';
    document.body.appendChild(overlay);

    // 创建标题和副标题
    const title = document.createElement('div');
    title.style.padding = '15px';
    title.style.textAlign = 'center';
    title.style.backgroundColor = '#007BFF';
    title.style.color = '#FFF';
    title.style.fontSize = '18px';
    title.style.fontWeight = 'bold';
    title.textContent = 'GeoFS航图查看器';
    overlay.appendChild(title);

    const subtitle = document.createElement('div');
    subtitle.style.textAlign = 'center';
    subtitle.style.color = '#666';
    subtitle.style.fontSize = '12px';
    subtitle.style.marginBottom = '10px';
    subtitle.textContent = '作者：開飛機のzm';
    overlay.appendChild(subtitle);

    // 创建关闭按钮
    const closeButton = document.createElement('button');
    closeButton.textContent = '×';
    closeButton.style.position = 'absolute';
    closeButton.style.top = '15px';
    closeButton.style.right = '15px';
    closeButton.style.backgroundColor = 'transparent';
    closeButton.style.border = 'none';
    closeButton.style.fontSize = '24px';
    closeButton.style.color = '#666';
    closeButton.style.cursor = 'pointer';
    closeButton.addEventListener('click', () => {
        overlay.style.display = 'none';
    });
    overlay.appendChild(closeButton);

    // 创建文件夹列表容器
    const folderList = document.createElement('div');
    folderList.style.padding = '0 20px';
    folderList.style.overflowY = 'auto';
    folderList.style.flex = '1';
    overlay.appendChild(folderList);

    // 创建“新建文件夹”按钮
    const createFolderButton = document.createElement('button');
    createFolderButton.textContent = '新建文件夹';
    createFolderButton.style.padding = '10px';
    createFolderButton.style.backgroundColor = '#007BFF';
    createFolderButton.style.color = '#FFF';
    createFolderButton.style.border = 'none';
    createFolderButton.style.borderRadius = '5px';
    createFolderButton.style.cursor = 'pointer';
    createFolderButton.style.width = '100%';
    createFolderButton.style.marginBottom = '20px';
    createFolderButton.style.fontSize = '14px';
    createFolderButton.style.transition = 'background-color 0.3s';
    createFolderButton.addEventListener('mouseenter', () => {
        createFolderButton.style.backgroundColor = '#0056b3';
    });
    createFolderButton.addEventListener('mouseleave', () => {
        createFolderButton.style.backgroundColor = '#007BFF';
    });
    createFolderButton.addEventListener('click', () => {
        const folderName = prompt('请输入文件夹名称：');
        if (folderName) {
            addFolder(folderName);
        }
    });
    folderList.appendChild(createFolderButton);

    // 添加文件夹
    function addFolder(name) {
        const folder = document.createElement('div');
        folder.style.marginBottom = '15px';
        folder.style.backgroundColor = '#FFF';
        folder.style.borderRadius = '8px';
        folder.style.boxShadow = '0 2px 5px rgba(0, 0, 0, 0.1)';
        folder.style.overflow = 'hidden';

        const folderHeader = document.createElement('div');
        folderHeader.style.display = 'flex';
        folderHeader.style.justifyContent = 'space-between';
        folderHeader.style.alignItems = 'center';
        folderHeader.style.padding = '10px';
        folderHeader.style.cursor = 'pointer';
        folderHeader.style.backgroundColor = '#f8f9fa';
        folderHeader.style.borderBottom = '1px solid #ddd';

        const folderNameDisplay = document.createElement('span');
        folderNameDisplay.textContent = name;
        folderNameDisplay.style.fontWeight = 'bold';
        folderNameDisplay.style.fontSize = '14px';

        const folderActions = document.createElement('div');
        folderActions.style.display = 'flex';
        folderActions.style.gap = '5px';

        const uploadButton = document.createElement('button');
        uploadButton.textContent = '上传';
        uploadButton.style.padding = '5px 10px';
        uploadButton.style.backgroundColor = '#28a745';
        uploadButton.style.color = '#FFF';
        uploadButton.style.border = 'none';
        uploadButton.style.borderRadius = '4px';
        uploadButton.style.cursor = 'pointer';
        uploadButton.style.fontSize = '12px';
        uploadButton.style.transition = 'background-color 0.3s';
        uploadButton.addEventListener('mouseenter', () => {
            uploadButton.style.backgroundColor = '#218838';
        });
        uploadButton.addEventListener('mouseleave', () => {
            uploadButton.style.backgroundColor = '#28a745';
        });
        uploadButton.addEventListener('click', (e) => {
            e.stopPropagation();
            uploadChart(folder);
        });

        const renameButton = document.createElement('button');
        renameButton.textContent = '重命名';
        renameButton.style.padding = '5px 10px';
        renameButton.style.backgroundColor = '#ffc107';
        renameButton.style.color = '#000';
        renameButton.style.border = 'none';
        renameButton.style.borderRadius = '4px';
        renameButton.style.cursor = 'pointer';
        renameButton.style.fontSize = '12px';
        renameButton.style.transition = 'background-color 0.3s';
        renameButton.addEventListener('mouseenter', () => {
            renameButton.style.backgroundColor = '#e0a800';
        });
        renameButton.addEventListener('mouseleave', () => {
            renameButton.style.backgroundColor = '#ffc107';
        });
        renameButton.addEventListener('click', (e) => {
            e.stopPropagation();
            const newName = prompt('请输入新的文件夹名称：', folderNameDisplay.textContent);
            if (newName) {
                folderNameDisplay.textContent = newName;
            }
        });

        const deleteButton = document.createElement('button');
        deleteButton.textContent = '删除';
        deleteButton.style.padding = '5px 10px';
        deleteButton.style.backgroundColor = '#dc3545';
        deleteButton.style.color = '#FFF';
        deleteButton.style.border = 'none';
        deleteButton.style.borderRadius = '4px';
        deleteButton.style.cursor = 'pointer';
        deleteButton.style.fontSize = '12px';
        deleteButton.style.transition = 'background-color 0.3s';
        deleteButton.addEventListener('mouseenter', () => {
            deleteButton.style.backgroundColor = '#c82333';
        });
        deleteButton.addEventListener('mouseleave', () => {
            deleteButton.style.backgroundColor = '#dc3545';
        });
        deleteButton.addEventListener('click', (e) => {
            e.stopPropagation();
            if (confirm('确定删除此文件夹吗？')) {
                folder.remove();
            }
        });

        folderActions.appendChild(uploadButton);
        folderActions.appendChild(renameButton);
        folderActions.appendChild(deleteButton);
        folderHeader.appendChild(folderNameDisplay);
        folderHeader.appendChild(folderActions);
        folder.appendChild(folderHeader);

        const folderContent = document.createElement('div');
        folderContent.style.display = 'none';
        folderContent.style.padding = '10px';
        folderContent.className = 'folder-content';
        folder.appendChild(folderContent);

        folderHeader.addEventListener('click', () => {
            folderContent.style.display = folderContent.style.display === 'none' ? 'block' : 'none';
        });

        folderList.appendChild(folder);
    }

    // 上传航图
    function uploadChart(folder) {
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = 'application/pdf';
        fileInput.style.display = 'none';
        fileInput.addEventListener('change', () => {
            const file = fileInput.files[0];
            const name = prompt('请输入航图名称：');
            if (file && name) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const chartItem = document.createElement('div');
                    chartItem.style.marginBottom = '10px';
                    chartItem.style.padding = '10px';
                    chartItem.style.backgroundColor = '#f8f9fa';
                    chartItem.style.borderRadius = '5px';
                    chartItem.style.border = '1px solid #ddd';
                    chartItem.style.cursor = 'pointer';
                    chartItem.style.transition = 'background-color 0.3s';
                    chartItem.addEventListener('mouseenter', () => {
                        chartItem.style.backgroundColor = '#e9ecef';
                    });
                    chartItem.addEventListener('mouseleave', () => {
                        chartItem.style.backgroundColor = '#f8f9fa';
                    });

                    const chartName = document.createElement('div');
                    chartName.textContent = name;
                    chartName.style.fontWeight = 'bold';
                    chartName.style.fontSize = '14px';
                    chartItem.appendChild(chartName);

                    chartItem.addEventListener('click', () => {
                        showPdfViewer(e.target.result);
                    });

                    folder.querySelector('.folder-content').appendChild(chartItem);
                };
                reader.readAsDataURL(file);
            }
        });
        fileInput.click();
    }

    // 显示PDF大图查看器
    function showPdfViewer(pdfUrl) {
        const pdfViewer = document.createElement('div');
        pdfViewer.style.position = 'fixed';
        pdfViewer.style.top = '0';
        pdfViewer.style.left = '0';
        pdfViewer.style.width = '100%';
        pdfViewer.style.height = '100%';
        pdfViewer.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
        pdfViewer.style.zIndex = '1002';
        pdfViewer.style.display = 'flex';
        pdfViewer.style.justifyContent = 'center';
        pdfViewer.style.alignItems = 'center';

        const iframe = document.createElement('iframe');
        iframe.src = pdfUrl;
        iframe.style.width = '90%';
        iframe.style.height = '90%';
        iframe.style.border = 'none';
        iframe.style.borderRadius = '10px';
        pdfViewer.appendChild(iframe);

        const closeButton = document.createElement('button');
        closeButton.textContent = '×';
        closeButton.style.position = 'absolute';
        closeButton.style.top = '20px';
        closeButton.style.right = '20px';
        closeButton.style.backgroundColor = 'transparent';
        closeButton.style.border = 'none';
        closeButton.style.fontSize = '30px';
        closeButton.style.color = '#FFF';
        closeButton.style.cursor = 'pointer';
        closeButton.addEventListener('click', () => {
            pdfViewer.remove();
        });
        pdfViewer.appendChild(closeButton);

        document.body.appendChild(pdfViewer);
    }

    // 添加快捷键功能
    document.addEventListener('keydown', (e) => {
        if (e.key === '/') {
            if (overlay.style.display === 'none') {
                overlay.style.display = 'flex';
            } else {
                overlay.style.display = 'none';
            }
        }
    });
})();
